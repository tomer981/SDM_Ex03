<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Zone Information</title>
    <script type="text/javascript" src="../../common/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="../../common/context-path-helper.js"></script>
    <script type="text/javascript" src="../../common/Urls.js"></script>
    <script type="text/javascript" src="../../common/is-session-exist.js"></script>
    <script type="text/javascript" src="../../common/generalMethods.js"></script>
    <link rel="stylesheet" href="../../common/styleTable.css">
</head>
<body>
<div style="overflow-x:auto;">
    <h1> Screen 3 : Zone - Store Information</h1>
    <br>
    <h3> Zone Products</h3>
    <table>
        <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Purchase<br>Category</th>
            <th>Store Sell</th>
            <th>Average<br>Price</th>
            <th>Amount Sold<br>
        </tr>
        </thead>
        <tbody id="zone-products-tableview">
        </tbody>
    </table>
    <br>
    <h3> Store Information</h3>
    <div id="general-store-info">
        <h4> General Store Information</h4>
        <table id="stores-table">
            <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Owner Name</th>
                <th>Location</th>
                <th>Orders</th>
                <th>Products Cost<br>In Orders</th>
                <th>PPK</th>
                <th>Deliveries<br>Earning</th>
            </tr>
            </thead>
            <tbody id="general-store-info-tableview">
            </tbody>
        </table>
        <h4> Store Products Information</h4>
        <table>
            <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Purchase<br>Category</th>
                <th>Product<br>Cost</th>
                <th>Sold</th>
            </tr>
            </thead>
            <tbody id="store-product-info">
            </tbody>
        </table>
    </div>
    <br>
    <a href="../zones/zones.html">Back</a>
</div>
<script type="text/javascript" language="javascript">
    isSessionExist({action: "isSessionExist", userNotFoundPage: "../../index.html", userFoundPage: ""});
    $("#zone-products-tableview").empty();
    $("#general-store-info-tableview").empty();
    $("#store-product-info").empty();
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const zoneName = urlParams.get('zoneName')


    $.ajax({
        method: "Get",
        url: "StoresServlet",
        data: {action: "getProductsInZone", zoneName: zoneName},
        success: function (arrProducts) {
            appendToTableView(arrProducts, "#zone-products-tableview");
        },
        error: function () {
            alert("error getProductsInZone");
        }
    })

    $.ajax({
        method: "Get",
        url: "StoresServlet",
        data: {action: "getStoreInfo", zoneName: zoneName},
        success: function (arrStoreInfo) {
            appendToTableView(arrStoreInfo, "#general-store-info-tableview");
            $("#stores-table tr").click(function () {
                    $(this).addClass("selected").siblings().removeClass("selected");
                    var storeId = $(this).find("td:first").html();
                    getStoreProducts(storeId);
                }
            )
        },
        error: function () {
            alert("error getStoreInfo");
        }
    })

    function getStoreProducts(storeId) {
        $.ajax({
            method: "Get",
            url: "StoresServlet",
            data: {action: "getStoreProductsInfo", zoneName: zoneName, storeId: storeId},
            success: function (arrProducts) {
                $("#store-product-info").empty();
                appendToTableView(arrProducts, "#store-product-info")
            },
            error: function () {
                alert("error getStoreProductsInfo");
            }
        })
    }


</script>
</body>
</html>