<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="../../../../../common/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="../../../../../common/jquery.editable.js"></script>
    <script type="text/javascript" src="../../../../../common/bootstrap-4.5.3-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../../common/bootstrap-4.5.3-dist/js/bootstable.js"></script>

    <script type="text/javascript" src="../../../../../common/context-path-helper.js"></script>
    <script type="text/javascript" src="../../../../../common/urls.js"></script>
    <script type="text/javascript" src="../../../../../common/is-session-exist.js"></script>
    <script type="text/javascript" src="../../../../../common/generalMethods.js"></script>
    <link rel="stylesheet" href="../../../../../common/styleTable.css">

</head>
<body>

<div style="overflow-x:auto;">
    <iframe id="order-page" src="../../../show-orders/show-orders.html" style="border:none;" frameborder="0"
            scrolling="no" width="100%" onload="resizeIframe(this)" title="Iframe Example"></iframe>
    <iframe id="sub-order-page" src="../../../show-orders/show-store-order/show-store-order.html" style="border:none;"
            frameborder="0" scrolling="no" width="100%" onload="resizeIframe(this)" title="Iframe Example"></iframe>
    <iframe id="products-page" src="../../../show-orders/show-products-order/show-products-order.html"
            style="border:none;" frameborder="0" scrolling="no" width="100%" onload="resizeIframe(this)"
            title="Iframe Example"></iframe>
</div>

<script type="application/javascript">
    isSessionExist({action: "isSessionExist", userNotFoundPage: "../../../../../index.html", userFoundPage: ""});
    var orderTable = {};
    var subOrderTable = {};
    var productsTable = {};

    function resizeIframe(obj) {
        obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
    }

    function resizeAll() {
        resizeIframe($("#order-page")[0]);
        resizeIframe($("#sub-order-page")[0]);
        resizeIframe($("#products-page")[0]);
    }

    $(document).ready(function () {
        orderTable = $("#order-page").contents().find("#orders-table")[0];//orders-body
        subOrderTable = $("#sub-order-page").contents().find("#sub-order-table")[0];
        productsTable = $("#products-page").contents().find("#products-body")[0];//products-body
        //getOrders()
        // displayOrder();
    });

    // function getOrders(){
    //     $.ajax({
    //         method: "Get",
    //         url: ORDER_URL,
    //         data: {action: "getInProgressOrder"},
    //         success: function (order) {
    //             ordersIds = JSON.stringify(order);
    //             displayOrder();
    //         }
    //     })
    // }

    function displayOrder(orders) {
        $.ajax({
            method: "Post",
            url: ORDER_URL,
            data: {action: "getDisplayOrder", orders: orders},
            success: function (ordersToDisplay) {
                orderTable = $("#order-page").contents().find("#orders-table tbody")[0];
                appendToTableViewInPage(ordersToDisplay, orderTable);
                registerClickOrder();
                resizeAll();
            }
        })
    }

    function registerClickOrder() {
        $("#order-page").contents().find("#orders-body tr").click(function (e) {
            $(this).addClass("selected").siblings().removeClass("selected");
            var orderId = $(this).find("td:first").html();
            var data = {action: "getSubOrdersCustomer", orderId: orderId}
            $.ajax({
                url: ORDER_URL,
                type: "Post",
                data: data,
                success: function (subOrders) {
                    $("#sub-order-page").contents().find("#sub-order-body").empty()
                    subOrderTable = $("#sub-order-page").contents().find("#sub-order-table tbody")[0];
                    appendToTableViewInPage(subOrders, subOrderTable)
                    registerClickSubOrder(orderId)
                    resizeAll()
                },
                error: function () {
                    alert("error getSubOrdersCustomer");
                }
            });
        });
    }


    function registerClickSubOrder(orderId) {
        $("#sub-order-page").contents().find("#sub-order-body tr").click(function (e) {
            $(this).addClass("selected").siblings().removeClass("selected");
            var storeId = $(this).find("td:first").html();
            var data = {action: "getSubOrdersProducts", orderId: orderId, storeId: storeId}
            $.ajax({
                url: ORDER_URL,
                type: "Post",
                data: data,
                success: function (products) {
                    $("#products-page").contents().find("#products-body").empty();
                    productsTable = $("#products-page").contents().find("#products-table tbody")[0];
                    appendToTableViewInPage(products, productsTable)
                    resizeAll(0);
                },
            });
        })
    }


</script>
</body>
</html>